---
title: 计算机网络读书笔记
original: 
date: 2018-3-23 21:43:25
comments: 
fancybox: 
categories:
- 面试
tags:
- 计算机网络
- 互联网
permalink: 网络
---

## 概述
### 网络的网络
![](/resource/f1fb826b-ecf4-4ddb-91f0-2bafecf08869.jpg)
>网络把主机连接起来，而互联网是把多种不同的网络连接起来，因此互联网是网络的网络。

<!--more-->

<style>
  .article-entry>p {
    display:table;
    margin:0 auto;
  }
</style>

### ISP
![](/resource/0f8c0a60-d4c6-47f4-978d-1a5c393fedac.jpg)
>- 互联网服务提供商ISP可以从互联网管理机构获得许多IP地址，同时拥有通信线路以及路由器等连网设备，个人或机构向ISP缴纳一定的费用就可以接入互联网。
- 目前互联网是一种多层次结构，ISP根据覆盖面的大小分为主干ISP、地区ISP、本地ISP。
- 互联网交换点IXP允许两个ISP直接相连而不用经过第三个ISP。



### 互联网的组成
![](/resource/8ab40d6d-bd7c-47d3-afe8-6a8bc9f5d04c.jpg)
> - 边缘部分：所有连接在互联网上的主机，用户可以直接使用。
- 核心部分：由大量的网络和连接这些的路由器组成，为边缘部分的主机提供服务。

### 主机之间的通信方式
> - 客户-服务器（C/S）：客户是服务的请求方，服务器是服务的提供方。
- 对等（P2P）：不区分客户端和服务器。

### 电路交换与分组交换
![](/resource/c50d230c-8b89-4644-8f62-8708d03aac5b.jpg)
> - 电路交换
  电路交换用于电话通信系统，两个用户要通信之前需要建立一条专用的物理链路，并且在整个通信过程中始终占用该链路。由于通信的过程中不可能一直在使用传输线路，因此电路交换对线路的利用率很低，往往不到10%。
- 报文交换
  报文交换用于邮局通信系统，邮局接收到一份报文之后，先存储下来，然后把相同目的地的报文一起转发到下一个目的地，这个过程就是存储转发过程。
- 分组交换
  分组交换也使用了存储转发，但是转发的是分组不是报文。把整块数据称为一个报文，由于一个报文可能很长，需要先进行切分，来满足分组能处理的大小。在每个切分的数据前面加上首部之后就成为了分组，首部包含目的地址和源地址等控制信息。
  ![](/resource/2366c2ad-5859-4d4e-805f-7e2b88061cd8.jpg)
  存储转发允许在一条传输线路上传送多个主机的分组，因此两个用户之间的通信不需要占用端到端的线路资源。
  相比于报文交换，由于分组比报文更小，因此分组交换的存储转发速度更加快速。

### 时延
> 总时延=发送时延+传播时延+处理时延+排队时延
![](/resource/ceee91c2-da26-4169-94c3-e4608b46b9ac.png)
> - 发送时延
 主机或路由器发送数据帧所需要的时间。
 $$ delay=l(bit)/v(bit/s) $$
 其中l表示数据帧的长度，v表示发送帧率。
- 传播时延
 电磁波在信道中传播一定的距离需要花费的时间，电磁波传播速度接近光速。
 $$ delay=l(m)/v(m/s) $$
 其中l表示信道长度，v表示电磁波在信道上的传播速率。
- 处理时延
 主机或路由器收到分组时进行处理所需要的时间。例如分析首部，从分组中提取数据部分等。
- 排队时延
 分组在路由器的输入队列和输出队列中排队等待的时间，取决于网络当前的通信量。

### 计算机网络体系结构 *
> 1. 七层协议
 如图a所示，其中表示层和会话层用途如下：
 1. 表示层：信息的语法、语义以及它们的关联，如加密解密、转换翻译、压缩解压缩。
 1. 会话层：不同机器上的用户之间建立及管理会话。
    ![](/resource/1005dc9d-9049-4b06-9524-6171e56ebd8c.png)
1. 五层协议
 1. 应用层：为特定应用程序提供数据传输服务，例如HTTP、DNS等，数据单位为报文。
 1. 运输层：提供的是进程间的通用数据传输服务。由于应用层协议很多，定义通用的运输层协议机就可以支持不断增多的应用层协议。运输层包括两种协议：传输控制协议TCP，提供面向连接、可靠的数据传输服务，数据单位为报文段；用户数据包协议UDP，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP主要提供完整性服务，UDP主要提供及时性服务。
 1. 网络层：为主机之间提供数据传输服务，而像运输层协议那样是为主机中的进程提供服务。网络层把运输层传递下来的报文段或用户数据报封装成分组。
 1. 数据链路层：网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，链路层协议就是为相邻结点间提供服务。数据链路层把网络层传来的分组封装成帧。
 1. 物理层：考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能的屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。
1. 数据在各层之间的传递过程
 - 在向下的过程中，需要添加下层协议所需要的首部或者尾部，而在向上的过程中不断拆开首部和尾部。
 - 路由器只有下面三层协议，因为路由器位于网络核心中，不需要为进程或者应用程序提供服务，因此也就不需要运输层和应用层。
 ![](/resource/ac106e7e-489a-4082-abd9-dabebe48394c.jpg)
1. TCP/IP体系结构
 - 它只有四层，相当于五层协议中数据链路层和物理层合并为网络接口层。
 - 现在的TCP/IP体系结构不严格遵循OSI分层概念，应用层可能会直接使用IP层或者网络接口层。
 ![](/resource/37b74a34-251c-45f8-88a4-614ec953f7e9.png)
 - TCP/IP协议族是一种沙漏形状，中间小两边大，IP协议在其中占用举足轻重的地位。
 ![](/resource/93cbce0c-c37d-429c-815b-861976a46bd8.png)

## 物理层
### 通信方式
> 1. 单向通信，又称为单工通信。
1. 双向交替通信，又称为半双工通信。
1. 双向同时通信，又称为全双工通信。

### 带通调制
> 模拟信号是连续的信号，数字信号是离散的信号。带通调制把数字信号转换为模拟信号。
 ![](/resource/d2c55c84-aa1f-43c1-bd97-457bcb7816b3.png)

### 信道复用技术
> 1. 频分复用、时分复用
 频分复用的所有用户在相同的时间占用不同频率带宽资源；时分复用的所有用户在不同的时间占用相同的频率带宽资源。
 使用这两种方式进行通信，在通信的过程中用户会一直占用一部分信道资源。但是由于计算机数据的突发性质，没必要一直用信道资源而不让出给其他用户使用，因此这两种方式对信道的利用率都不高。
 ![](/resource/543d47a1-f0dd-414f-b23c-0c142c814854.png)
>2. 统计时分复用
 是对时分复用的一种改进，不固定每个用户在时分复用帧中的位置，只要有数据就集中起来组成统计时分复用帧然后发送。
 ![](/resource/29058e09-bb72-4040-a73d-4c497895e9ce.jpg)
>3. 波分复用
 光的频分复用。由于光的频率很高，因此习惯用波长而不是频率来表示所使用的光载波。
 ![](/resource/78534153-88d1-4f83-a6e0-59064dbdc43a.png)
>4. 码分复用
 为每个用户分配m bit的码片，并且所有的码片正交，对于任意两个码片S和T有
 S*T/m=0
 为了方便，取m=8，设码片S为00011011。在拥有该码片的用户发送比特1时就发送该码片，发送比特0是就发送该码片的反码11100100。
 在计算时将00011011记做(-1-1-1+1+1-1+1+1)，可以得到
 S*S/m=1
 S^i（S的反码）*S/m=1
 利用上面的式子我们知道，当接收端使用码片S对接收到的数据进行内积运算时，结果为0的是其他用户发送的数据，结果为1的是用户发送的比特1，结果为-1的是用户发送的比特0。
 码分复用需要发送的数据量为原先的m倍。
 ![](/resource/0042edad-8e3b-4279-bd93-6906fcd1b640.jpg)

## 数据链路层
### 三个基本问题
> 1. 封装成帧
 将网络层传下来的分组添加到首部和尾部，用于标记帧的开始和结束。
 ![](/resource/3402d1c0-7020-4249-9a7f-12ea2ea6adf7.jpg)
1. 透明传输
 透明表示实际存在的事物好像不存在一样。
 帧使用首部和尾部进行定界，如果帧的数据部分含有和首部尾部相同的内容，那么帧的开始和结束位置就会被错误的判定，需要在数据部分出现首部尾部相同的内容前面插入转义字符，如果出现转义字符，那么就在转义字符前面再加个转义字符，在接收端进行处理
 之后可以还原出原始数据。这个过程透明传输的内容是转义字符，用户察觉不到转义字符的存在。
 ![](/resource/4146e14b-56b9-433c-8e3d-74b1b325399c.jpg)
1. 差错检测
 目前数据链路层广泛使用了循环冗余（CRC）来检查比特差错。

### 点对点信道-PPP协议
>互联网用户通常需要连接到某个ISP之后才能接入到互联网，PPP协议就是用户计算机和ISP进行通信时所使用的数据链路层协议。
![](/resource/8393f520-d824-44ea-a5f3-1c1a73d735fb.jpg)
>在PPP的帧中
 - F字段为帧的定界符
 - A和C的字段暂时没有意义
 - FCS字段是使用CRC的检验序列
 - 信息部分的长度不超过1500字节
![](/resource/0f39c274-b79c-4e83-8c7c-94fc2747832d.jpg)

### 局域网的拓补
![](/resource/8b15e36f-69b4-46b6-a07c-7234ac7c7927.jpg)

### 广播信道-CSMA/CD协议 *
>在广播信道上，同一时间只能允许一台计算机发送数据。
CSMA/CD表示载波监听多点接入/碰撞检测。
- 多点接入：说明这是总线型网络，许多计算机以多点的方式连接到总线上。
- 载波监听：每个站都必须不停的监听信道。在发送前，如果监听信道正在使用，就必须等待。
- 碰撞检测：在发送中，如果监听到信道已有其他站正在发送数据，就表示发生了碰撞。虽然每一个站在发送数据之前都已经监听到信道为空闲，但是由于电磁波的传播时延的存在，还是可能发送碰撞。
![](/resource/f9ed4da5-0032-41e6-991a-36d995ec28fd.png)
记端到端的传播时延为τ，最先发送的站点最多经过2τ就可以知道是否发生了碰撞，称2τ为`争用期`。只有经过争用期之后还没有检测到碰撞，才能肯定这次发送不会发送碰撞。
当发生碰撞时，站点要停止发送，等待一段时间再发送。这个时间采用`截断二进制指数退避算法`来确定，从离散的整数集合{0,1,...,(2^k-1)}中随机去除一个数，记做r，然后取r倍的争用期作为重传等待时间。

### 扩展局域网 *
>1. 在物理层进行扩展
 - 使用集线器进行扩展。
 - 集线器的主要功能是对接收到的信号进行放大，以扩大网络的传输距离。
 - 集线器不能根据MAC地址进行转发，而是以广播的方式发送数据帧。
 - 集线器是一种共享式的传输设备，意味着同一时刻只能传输一组数据帧。
 ![](/resource/823cdab7-3779-4e3a-a951-dc2d154e0ee6.jpg)
1. 在链路层进行扩展
 - 最开始使用的是网桥，它接收到一个帧时，根据帧的MAC地址，查找网桥中的地址表，确定将帧转发的接口。
 - 网桥不是共享式设备，因此性能比集线器这种共享设备更高。
 - 交换机的问世很快就淘汰了网桥，它实质上是一个多接口网桥，而网桥是两接口。交换机的每个接口都能直接与一个主机或者另一个交换机相连，并且一般都工作在全双工方式。
 - 交换机具有学习能力，学习的是交换表的内容，交换表中存储着MAC地址到接口的映射。下图中，交换机有4个接口，主机A向主机B发送数据帧时，交换机把主机A到接口1的映射写入交换表中。为了发送数据帧到B，先查交换表，此时没有主机B的表项，那么主机A就发送广播帧，主机C和主机D会丢弃该项，主机B收下之后，查找交换表得到主机A映射的接口为1，因此就把帧发送主机A，同时交换机添加主机B到接口3的映射。
 ![](/resource/c9cfcd20-c901-435f-9a07-3e46830c359f.jpg)
1. 虚拟局域网
 虚拟局域网可以建立与物理位置无关的逻辑组，只有在同一个虚拟局域网中的成员才会收到链路层广播信息，例如下图中（A1,A2,A3,A4）属于一个虚拟局域网，A1发送的广播会被A2,A3,A4收到，而其他站点收不到。
 ![](/resource/a74b70ac-323a-4b31-b4d5-90569b8a944b.png)

### MAC层 *
>MAC地址是6字节（48位）的地址，用于唯一标识网络适配器（网卡），一台主机拥有多少个适配器就有多少个MAC地址，例如笔记本电脑普遍存在无线网络适配器和有线网络适配器。
![](/resource/50d38e84-238f-4081-8876-14ef6d7938b5.jpg)
- 类型：标记上层使用的协议。
- 数据：长度在46~1500之间，如果太小则需要填充。
- FCS：帧检验序列，使用的是CRC检验方法。
- 前同步码：只是为了计算FCS临时加入的，计算之后会丢弃。

## 网络层 *
### 网际协议IP概述
> - 因为网络层是整个互联网的核心，因此应当让网络层尽可能的简单。网络层向上只提供简单灵活、无连接、尽最大努力交互的数据报服务。
- 使用IP协议，可以把异构的物理网络连接起来，使得网络层看起来好像是一个统一的网络。
![](/resource/fe3d224c-8ffd-40f9-85b1-86ffe1393f6c.jpg)
- 与IP协议配套使用的还有三个协议：
 1. 地址解析协议ARP
 1. 网际控制报文协议ICMP
 1. 网际组管理协议IGMP
 ![](/resource/163cf8b4-5f30-46c9-af00-316a71b3c890.jpg)

### IP数据报格式
![](/resource/8681db55-0873-434b-aa98-83d07e8392ae.jpg)
> - 版本：有4（IPV4）和6（IPV6）两个值。




